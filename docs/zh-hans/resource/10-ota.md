## 设备固件升级

固件升级主要用于修复设备bug和增加设备新功能。固件升级主要分两种，第一种是设备升级，第二种是MCU升级。这里的wifi设备的固件升级均指设备升级。

### 业务基本链路

设备升级过程涉及手机APP 、设备、涂鸦云三端

- 手机APP：升级进度结果的展示 或者 升级消息的发起者

- 涂鸦云： 升级过程中的管理者，负责升级固件的存储，设备升级状态的更新，升级文案推送

- 设备: 负责接收固件，固件升级的执行者

### 固件包配置说明

1. 网关或子设备配网成功后，从TuyaApp上获取设备信息里的虚拟ID，作为固件升级的白名单

2. 编译出要升级的固件包，固件版本要高于设备中运行的固件版本

3. 登录 https://iot.tuya.com/index 开发者平台，到对应创建的产品下，上传配置固件包

操作说明：https://docs.tuya.com/cn/product/ota.html

- wifi设备的固件升级时，固件类型选择 SDK固件
- wifi设备的MCU固件升级时，固件类型选择 MCU固件

### 升级开始的方式

设备固件上传到云端后，设备不会立即收到升级消息，目前涂鸦支持以下几种方式：

- App提醒升级: 用户首次打开设备面板时，会收到升级提醒弹框，可选择升级或不升级；
- App静默升级: 即设备静默升级，设备重启后，会向云端请求一次是否有静默升级任务，有的话直接进行升级；如果用户去打开设备面板，此时会有进度框显示，此时设备是无法操作的；
- App强制升级: 用户首次打开设备面板时，会收到升级提醒弹框，只有确定可选，负责设备无法操作；
- App检测升级: 即App用户主动点击对应设备的面板，然后点击右上角进入设备信息界面，检测设备固件版本，主动更新；
